#!/usr/bin/env node

const fs = require('fs')
const path = require('path')
const mkdir = require('mkdirp').sync
const inline = require('web-resource-inliner')

const args = process.argv.slice(2)
const pwd = process.cwd()

const input = path.resolve(pwd, args[0])
const output = args[1] ? path.resolve(pwd, args[1]) : input

if (!fs.existsSync(input)) throw new Error(`File '${input}' does not exist`)

mkdir(path.dirname(output))

const opts = {
	fileContent: fs.readFileSync(input, 'utf8'),
	relativeTo: path.dirname(input),
	inlineAttribute: 'rel="stylesheet"',
	images: false,
	svgs: false,
	links: false,
	scripts: false,
	strict: true
}

inline.html(opts, (err, contents) => {
	if (err) {
		throw err
	}
	fs.writeFileSync(output, contents)
})
